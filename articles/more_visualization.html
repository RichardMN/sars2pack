<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualizing geographic COVID-19 trends without maps • sars2pack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualizing geographic COVID-19 trends without maps">
<meta property="og:description" content="sars2pack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sars2pack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/add_a_dataset.html">How to add a new dataset to sars2pack</a>
    </li>
    <li>
      <a href="../articles/case_tracking.html">Case tracking datasets</a>
    </li>
    <li>
      <a href="../articles/current_data_overview.html">COVID-19 Graphical Status Report</a>
    </li>
    <li>
      <a href="../articles/datasets.html">Overview of available datasets</a>
    </li>
    <li>
      <a href="../articles/doMCMC.html">Building MCMC-based models of SI for SARS-Cov-2</a>
    </li>
    <li>
      <a href="../articles/index.html">Introduction to sars2pack</a>
    </li>
    <li>
      <a href="../articles/map_visualization.html">Geospatial visualization of COVID-19 datasets</a>
    </li>
    <li>
      <a href="../articles/more_visualization.html">Visualizing geographic COVID-19 trends without maps</a>
    </li>
    <li>
      <a href="../articles/overview.html">Exploring the COVID-19 pandemic using sars2pack</a>
    </li>
    <li>
      <a href="../articles/phylogenetics.html">Phylogenetic data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/seandavi/sars2pack">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="more_visualization_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualizing geographic COVID-19 trends without maps</h1>
                        <h4 class="author">Joe A. Wasserman <a href="mailto:jwasserman@rti.org" class="email">jwasserman@rti.org</a> and Crystal T. Nguyen <a href="mailto:ctnguyen@rti.org" class="email">ctnguyen@rti.org</a>
</h4>
            
            <h4 class="date">December 21, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/seandavi/sars2pack/blob/master/vignettes/more_visualization.Rmd"><code>vignettes/more_visualization.Rmd</code></a></small>
      <div class="hidden name"><code>more_visualization.Rmd</code></div>

    </div>

    
    
<div id="visualizing-geographic-data-without-maps" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-geographic-data-without-maps" class="anchor"></a>Visualizing geographic data without maps</h1>
<p>You may have seen visualizations of COVID-19 cases plotted on a map. These maps often represent quantitative information either using color in proportion to values (these are called “choropleths”) or circle area proportional to values (these are called bubble plots). While visually striking, these maps are limited in terms of the amount of quantitative information they can communicate about regions. Here, we take a different approach that allows us to create basically any visual display of quantitative information and present it with an approximation of the geographic context.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hafen/geofacet">geofacet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sars2pack</span><span class="op">)</span></code></pre></div>
<div id="prepping-the-data-from-sars2pack" class="section level2">
<h2 class="hasAnchor">
<a href="#prepping-the-data-from-sars2pack" class="anchor"></a>Prepping the data from sars2pack</h2>
<p>Let’s start with US county-level data from JHU and state-level data from the COVID Tracking Project.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cusa</span> <span class="op">=</span> <span class="fu"><a href="../reference/jhu_us_data.html">jhu_us_data</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">cusa</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 2,231,120
## Columns: 15
## $ UID          &lt;dbl&gt; 84001001, 84001001, 84001001, 84001001, 84001001, 840010…
## $ iso2         &lt;chr&gt; "US", "US", "US", "US", "US", "US", "US", "US", "US", "U…
## $ iso3         &lt;chr&gt; "USA", "USA", "USA", "USA", "USA", "USA", "USA", "USA", …
## $ code3        &lt;dbl&gt; 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 8…
## $ fips         &lt;chr&gt; "01001", "01001", "01001", "01001", "01001", "01001", "0…
## $ county       &lt;chr&gt; "Autauga", "Autauga", "Autauga", "Autauga", "Autauga", "…
## $ state        &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "…
## $ country      &lt;chr&gt; "US", "US", "US", "US", "US", "US", "US", "US", "US", "U…
## $ Lat          &lt;dbl&gt; 32.53953, 32.53953, 32.53953, 32.53953, 32.53953, 32.539…
## $ Long         &lt;dbl&gt; -86.64408, -86.64408, -86.64408, -86.64408, -86.64408, -…
## $ Combined_Key &lt;chr&gt; "Autauga, Alabama, US", "Autauga, Alabama, US", "Autauga…
## $ Population   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ date         &lt;date&gt; 2020-01-22, 2020-01-23, 2020-01-24, 2020-01-25, 2020-01…
## $ count        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ subset       &lt;chr&gt; "confirmed", "confirmed", "confirmed", "confirmed", "con…</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctp</span> <span class="op">=</span> <span class="fu"><a href="../reference/covidtracker_data.html">covidtracker_data</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">ctp</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 16,427
## Columns: 16
## $ date                   &lt;date&gt; 2020-12-20, 2020-12-20, 2020-12-20, 2020-12-2…
## $ fips                   &lt;chr&gt; "00002", "00001", "00005", "00060", "00004", "…
## $ state                  &lt;chr&gt; "AK", "AL", "AR", "AS", "AZ", "CA", "CO", "CT"…
## $ positive               &lt;int&gt; 42413, 322452, 201650, 0, 453597, 1854456, 308…
## $ negative               &lt;int&gt; 1154093, 1521292, 1769637, 2140, 2214639, 2761…
## $ death                  &lt;int&gt; 184, 4389, 3237, 0, 7971, 22593, 4368, 5581, 7…
## $ pending                &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 6653, …
## $ hospitalized           &lt;int&gt; 935, 30224, 10502, NA, 33037, NA, 17171, 12257…
## $ hospitalizedCurrently  &lt;int&gt; 127, 2337, 1061, NA, 3899, 17750, 1398, 1167, …
## $ recovered              &lt;int&gt; 7165, 183625, 175387, NA, 66981, NA, 16372, 98…
## $ inIcuCumulative        &lt;int&gt; NA, 2390, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ inIcuCurrently         &lt;int&gt; NA, NA, 345, NA, 885, 3710, NA, NA, 72, 66, NA…
## $ onVentilatorCurrently  &lt;int&gt; 13, NA, 177, NA, 595, NA, NA, NA, 26, NA, NA, …
## $ onVentilatorCumulative &lt;int&gt; NA, 1377, 1136, NA, NA, NA, NA, NA, NA, NA, NA…
## $ dateChecked            &lt;dttm&gt; 2020-12-20 03:59:00, 2020-12-20 11:00:00, 202…
## $ dataQualityGrade       &lt;chr&gt; "A", "A", "A+", "D", "A+", "B", "A", "C", "A+"…</code></pre>
<p>We need to very lightly clean cumulative data that <em>should</em> be monotonically increasing day-over-day (but isn’t always) and convert it from cumulative values to daily incidents. The data are in different formats, so we’ll use slightly different data munging workflows.</p>
<p>The JHU data don’t contain a value for every location-date-subset combination, so we need to fill in those gaps.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iusa</span> <span class="op">&lt;-</span> <span class="va">cusa</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Combined_Key</span>, <span class="va">subset</span>, <span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Combined_Key</span>, <span class="va">subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin.int</a></span><span class="op">(</span><span class="va">count</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span><span class="op">(</span><span class="va">count</span>, order_by <span class="op">=</span> <span class="va">date</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
         incidents <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax.int</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">count</span>, <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">count</span>, order_by <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span>, 
                                        <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">...</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
                               <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">subset</span>, 
           <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">nesting</a></span><span class="op">(</span><span class="va">UID</span>, <span class="va">iso2</span>, <span class="va">iso3</span>, <span class="va">code3</span>, <span class="va">fips</span>, <span class="va">county</span>, <span class="va">state</span>, <span class="va">country</span>, <span class="va">Lat</span>, <span class="va">Long</span>, <span class="va">Combined_Key</span><span class="op">)</span>,
           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>incidents <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>incidents <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Combined_Key</span>, <span class="va">subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ma7 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">incidents</span>, k <span class="op">=</span> <span class="fl">7</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2020-03-15"</span>, <span class="va">iso2</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">iusa</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 1,996,786
## Columns: 17
## $ date         &lt;date&gt; 2020-03-15, 2020-03-15, 2020-03-15, 2020-03-15, 2020-03…
## $ subset       &lt;chr&gt; "confirmed", "confirmed", "confirmed", "confirmed", "con…
## $ UID          &lt;dbl&gt; 84001001, 84001003, 84001005, 84001007, 84001009, 840010…
## $ iso2         &lt;chr&gt; "US", "US", "US", "US", "US", "US", "US", "US", "US", "U…
## $ iso3         &lt;chr&gt; "USA", "USA", "USA", "USA", "USA", "USA", "USA", "USA", …
## $ code3        &lt;dbl&gt; 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 840, 8…
## $ fips         &lt;chr&gt; "01001", "01003", "01005", "01007", "01009", "01011", "0…
## $ county       &lt;chr&gt; "Autauga", "Baldwin", "Barbour", "Bibb", "Blount", "Bull…
## $ state        &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "…
## $ country      &lt;chr&gt; "US", "US", "US", "US", "US", "US", "US", "US", "US", "U…
## $ Lat          &lt;dbl&gt; 32.53953, 30.72775, 31.86826, 32.99642, 33.98211, 32.100…
## $ Long         &lt;dbl&gt; -86.64408, -87.72207, -85.38713, -87.12511, -86.56791, -…
## $ Combined_Key &lt;chr&gt; "Autauga, Alabama, US", "Baldwin, Alabama, US", "Barbour…
## $ Population   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ count        &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ incidents    &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ ma7          &lt;dbl&gt; 0.0000000, 0.1428571, 0.0000000, 0.0000000, 0.0000000, 0…</code></pre>
<p>The COVID Tracking Project data doesn’t have a record for every location-date combination and can contain NA values, so we need to fill in the gaps and also transform it into long format for plotting</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">US_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'AL'</span>, <span class="st">'AK'</span>, <span class="st">'AR'</span>, <span class="st">'AZ'</span>, <span class="st">'CA'</span>, <span class="st">'CO'</span>, <span class="st">'CT'</span>, <span class="st">'DC'</span>, <span class="st">'DE'</span>, <span class="st">'FL'</span>, <span class="st">'GA'</span>,
               <span class="st">'HI'</span>, <span class="st">'IA'</span>, <span class="st">'ID'</span>, <span class="st">'IL'</span>, <span class="st">'IN'</span>, <span class="st">'KS'</span>, <span class="st">'KY'</span> ,<span class="st">'LA'</span>, <span class="st">'MA'</span>, <span class="st">'MD'</span>, <span class="st">'ME'</span>,
               <span class="st">'MI'</span>, <span class="st">'MN'</span>, <span class="st">'MO'</span>, <span class="st">'MS'</span>, <span class="st">'MT'</span>, <span class="st">'NC'</span>, <span class="st">'ND'</span>, <span class="st">'NE'</span>, <span class="st">'NH'</span>, <span class="st">'NJ'</span>, <span class="st">'NM'</span>,
               <span class="st">'NV'</span>, <span class="st">'NY'</span>, <span class="st">'OH'</span>, <span class="st">'OK'</span>, <span class="st">'OR'</span>, <span class="st">'PA'</span>, <span class="st">'RI'</span>, <span class="st">'SC'</span>, <span class="st">'SD'</span>, <span class="st">'TN'</span>, <span class="st">'TX'</span>,
               <span class="st">'UT'</span>, <span class="st">'VA'</span>, <span class="st">'VT'</span>, <span class="st">'WA'</span>, <span class="st">'WI'</span>, <span class="st">'WV'</span>, <span class="st">'WY'</span><span class="op">)</span>

<span class="va">ictp</span> <span class="op">&lt;-</span> <span class="va">ctp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"positive"</span>, <span class="st">"negative"</span>, <span class="st">"death"</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin.int</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span><span class="op">(</span><span class="va">.</span>, order_by <span class="op">=</span> <span class="va">date</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"positive"</span>, <span class="st">"negative"</span>, <span class="st">"death"</span><span class="op">)</span>,          
            <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>incidents <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax.int</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">.</span>, order_by <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span>, 
                                           <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">...</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
                                  <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">nesting</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">fips</span><span class="op">)</span>,
           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>positive_incidents <span class="op">=</span> <span class="fl">0</span>, negative_incidents <span class="op">=</span> <span class="fl">0</span>, death_incidents <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>test_incidents <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">positive_incidents</span>, <span class="va">negative_incidents</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">...</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
         pos_pct <span class="op">=</span> <span class="va">positive_incidents</span> <span class="op">/</span> <span class="va">test_incidents</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>positive <span class="op">=</span> <span class="fl">0</span>, negative <span class="op">=</span> <span class="fl">0</span>, death <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"_incidents"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ma7 <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollmean.html">rollmean</a></span><span class="op">(</span><span class="va">.</span>, k <span class="op">=</span> <span class="fl">7</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"_incidents"</span><span class="op">)</span><span class="op">)</span>, <span class="va">na_if</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>positive_pct_ma7 <span class="op">=</span> <span class="va">positive_incidents_ma7</span> <span class="op">/</span> <span class="va">test_incidents_ma7</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2020-03-15"</span>, <span class="va">state</span> <span class="op">%in%</span> <span class="va">US_states</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">ictp</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 14,331
## Columns: 26
## $ date                   &lt;date&gt; 2020-03-15, 2020-03-15, 2020-03-15, 2020-03-1…
## $ state                  &lt;chr&gt; "AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DC"…
## $ fips                   &lt;chr&gt; "00002", "00001", "00005", "00004", "00006", "…
## $ positive               &lt;dbl&gt; 0, 12, 16, 12, 293, 131, 20, 16, 6, 91, 99, 2,…
## $ negative               &lt;dbl&gt; 144, 28, 103, 121, 916, 627, 125, 79, 36, 678,…
## $ death                  &lt;dbl&gt; 0, 0, 0, 0, 5, 1, 0, 0, 0, 4, 1, 0, 0, 0, 0, 0…
## $ pending                &lt;int&gt; NA, 46, 30, 50, NA, NA, NA, 20, 32, 454, NA, N…
## $ hospitalized           &lt;int&gt; 1, NA, NA, 36, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ hospitalizedCurrently  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ recovered              &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ inIcuCumulative        &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ inIcuCurrently         &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ onVentilatorCurrently  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ onVentilatorCumulative &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ dateChecked            &lt;dttm&gt; 2020-03-13 16:30:00, 2020-03-15 14:12:00, 202…
## $ dataQualityGrade       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ positive_incidents     &lt;dbl&gt; NA, 6, 4, NA, 41, NA, 9, 6, NA, 40, 33, NA, 1,…
## $ negative_incidents     &lt;dbl&gt; NA, 6, 38, NA, NA, NA, NA, 30, NA, 200, NA, NA…
## $ death_incidents        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, NA, NA,…
## $ test_incidents         &lt;dbl&gt; NA, 12, 42, NA, 41, NA, 9, 36, NA, 240, 33, NA…
## $ pos_pct                &lt;dbl&gt; NaN, 0.50000000, 0.09523810, NaN, 1.00000000, …
## $ positive_incidents_ma7 &lt;dbl&gt; 0.0000000, 1.7142857, 2.2857143, 1.0000000, 29…
## $ negative_incidents_ma7 &lt;dbl&gt; 18.571429, 4.000000, 13.857143, 11.000000, 64.…
## $ death_incidents_ma7    &lt;dbl&gt; 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.…
## $ test_incidents_ma7     &lt;dbl&gt; 18.5714286, 5.7142857, 16.1428571, 12.0000000,…
## $ positive_pct_ma7       &lt;dbl&gt; 0.00000000, 0.30000000, 0.14159292, 0.08333333…</code></pre>
</div>
<div id="plotting-one-geographic-unit-example-new-york-state" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-one-geographic-unit-example-new-york-state" class="anchor"></a>Plotting one geographic unit (example: New York state)</h2>
<p>Before plotting, let’s customize the theme so we don’t have to do so repeatedly for ever plot.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme_light2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span><span class="op">)</span>,
        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p>Let’s start by plotting confirmed positive cases and deaths in a single state. As you can see by the vertical bars, these data are fairly noisy. We also know that under-reporting is common around weekends. To address both of these issues, we include a line for rolling 7-day means. To facilitate interpretation, we include another line for the proportion of positive tests. Confirmed positive cases and COVID-19 deaths depend on testing–with insufficient tests, these numbers are under-counted. Heuristically, when 10% or fewer tests return positive, testing is considered sufficient.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">ictp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"NY"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span>

<span class="va">g</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">positive_incidents</span>, fill <span class="op">=</span> <span class="st">"positive_incidents"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">death_incidents</span>, fill <span class="op">=</span> <span class="st">"death_incidents"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">positive_incidents_ma7</span>, color <span class="op">=</span> <span class="st">"positive_incidents"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">death_incidents_ma7</span>, color <span class="op">=</span> <span class="st">"death_incidents"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">^</span><span class="va">positive_pct_ma7</span>, color <span class="op">=</span> <span class="st">"pos_pct_ma7"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
                     name <span class="op">=</span> <span class="st">"Incidents (log 10 scale)"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span>,
                     sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">.</span>, base <span class="op">=</span> <span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.9</span>, <span class="fl">.2</span><span class="op">)</span>,
                                         name <span class="op">=</span> <span class="st">"Positive Test Rate (%, 7-day moving average)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_light2</span></code></pre></div>
<p><img src="more_visualization_files/figure-html/plot%20WA-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-multiple-geographic-units-example-all-us-states" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-multiple-geographic-units-example-all-us-states" class="anchor"></a>Plotting multiple geographic units (example: all US states)</h2>
<p>Now let’s plot all US states (and DC) simultaneously. To situate these states in their approximate geographic context, we use the {geofacet} package. This package provides a convenient way to arrange small multiples in a grid that correspond to their relative geographic positions. Because these small multiples have less area than the single-state plot, we don’t include daily incidents and instead focus only on 7-day rolling averages.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g_state</span> <span class="op">&lt;-</span> <span class="va">ictp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span>

<span class="va">g_state</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">positive_incidents</span>, color <span class="op">=</span> <span class="st">"positive_incidents"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">death_incidents</span>, color <span class="op">=</span> <span class="st">"death_incidents"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">positive_incidents_ma7</span>, fill <span class="op">=</span> <span class="st">"positive_incidents"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">death_incidents_ma7</span>, fill <span class="op">=</span> <span class="st">"death_incidents"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">^</span><span class="va">positive_pct_ma7</span>, color <span class="op">=</span> <span class="st">"pos_pct_ma7"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
                     name <span class="op">=</span> <span class="st">"Incidents (7-day moving average, log 10 scale)"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span>,
                     sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">.</span>, base <span class="op">=</span> <span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.9</span>, <span class="fl">.2</span><span class="op">)</span>,
                                         name <span class="op">=</span> <span class="st">"Positive Test Rate (%, 7-day moving average)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geofacet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geofacet/man/facet_geo.html">facet_geo</a></span><span class="op">(</span><span class="op">~</span> <span class="va">state</span>, label <span class="op">=</span> <span class="st">"state"</span>, move_axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_light2</span></code></pre></div>
<p><img src="more_visualization_files/figure-html/plot%20US%20states-1.png" width="1152" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-multiple-geographic-units-example-all-washington-state-counties" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-multiple-geographic-units-example-all-washington-state-counties" class="anchor"></a>Plotting multiple geographic units (example: all Washington state counties)</h2>
<p>We can do something similar at a county level within states using JHU data, which doesn’t include testing information. At the county level, the data are even noisier.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g_wa</span> <span class="op">&lt;-</span> <span class="va">iusa</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code_fips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">fips</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span>

<span class="va">g_wa</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ma7</span>, fill <span class="op">=</span> <span class="va">subset</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/log_trans.html">pseudo_log_trans</a></span><span class="op">(</span>base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
                   name <span class="op">=</span> <span class="st">"Incidents (7-day moving average, log 10 scale)"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/geofacet/man/facet_geo.html">facet_geo</a></span><span class="op">(</span><span class="op">~</span> <span class="va">county</span>, grid <span class="op">=</span> <span class="st">"us_wa_counties_grid1"</span>, label <span class="op">=</span> <span class="st">"name"</span>, move_axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_light2</span></code></pre></div>
<p><img src="more_visualization_files/figure-html/plot%20WA%20counties-1.png" width="1056" style="display: block; margin: auto;"></p>
</div>
<div id="extending-geographic-facets-to-other-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-geographic-facets-to-other-regions" class="anchor"></a>Extending geographic facets to other regions</h2>
<p>Many additional grids are built-in to {geofacet}.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/geofacet/man/get_grid_names.html">get_grid_names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   [1] "us_state_grid1"                           
##   [2] "us_state_grid2"                           
##   [3] "eu_grid1"                                 
##   [4] "aus_grid1"                                
##   [5] "sa_prov_grid1"                            
##   [6] "gb_london_boroughs_grid"                  
##   [7] "nhs_scot_grid"                            
##   [8] "india_grid1"                              
##   [9] "india_grid2"                              
##  [10] "argentina_grid1"                          
##  [11] "br_states_grid1"                          
##  [12] "sea_grid1"                                
##  [13] "mys_grid1"                                
##  [14] "fr_regions_grid1"                         
##  [15] "de_states_grid1"                          
##  [16] "us_or_counties_grid1"                     
##  [17] "us_wa_counties_grid1"                     
##  [18] "us_in_counties_grid1"                     
##  [19] "us_in_central_counties_grid1"             
##  [20] "se_counties_grid1"                        
##  [21] "sf_bay_area_counties_grid1"               
##  [22] "ua_region_grid1"                          
##  [23] "mx_state_grid1"                           
##  [24] "mx_state_grid2"                           
##  [25] "scotland_local_authority_grid1"           
##  [26] "us_state_without_DC_grid1"                
##  [27] "italy_grid1"                              
##  [28] "italy_grid2"                              
##  [29] "be_province_grid1"                        
##  [30] "us_state_grid3"                           
##  [31] "jp_prefs_grid1"                           
##  [32] "ng_state_grid1"                           
##  [33] "bd_upazila_grid1"                         
##  [34] "spain_prov_grid1"                         
##  [35] "ch_cantons_grid1"                         
##  [36] "ch_cantons_grid2"                         
##  [37] "china_prov_grid1"                         
##  [38] "world_86countries_grid"                   
##  [39] "se_counties_grid2"                        
##  [40] "uk_regions1"                              
##  [41] "us_state_contiguous_grid1"                
##  [42] "sk_province_grid1"                        
##  [43] "ch_aargau_districts_grid1"                
##  [44] "jo_gov_grid1"                             
##  [45] "spain_ccaa_grid1"                         
##  [46] "spain_prov_grid2"                         
##  [47] "world_countries_grid1"                    
##  [48] "br_states_grid2"                          
##  [49] "china_city_grid1"                         
##  [50] "kr_seoul_district_grid1"                  
##  [51] "nz_regions_grid1"                         
##  [52] "sl_regions_grid1"                         
##  [53] "us_census_div_grid1"                      
##  [54] "ar_tucuman_province_grid1"                
##  [55] "us_nh_counties_grid1"                     
##  [56] "china_prov_grid2"                         
##  [57] "pl_voivodeships_grid1"                    
##  [58] "us_ia_counties_grid1"                     
##  [59] "us_id_counties_grid1"                     
##  [60] "ar_cordoba_dep_grid1"                     
##  [61] "us_fl_counties_grid1"                     
##  [62] "ar_buenosaires_communes_grid1"            
##  [63] "nz_regions_grid2"                         
##  [64] "oecd_grid1"                               
##  [65] "ec_prov_grid1"                            
##  [66] "nl_prov_grid1"                            
##  [67] "ca_prov_grid1"                            
##  [68] "us_nc_counties_grid1"                     
##  [69] "mx_ciudad_prov_grid1"                     
##  [70] "bg_prov_grid1"                            
##  [71] "us_hhs_regions_grid1"                     
##  [72] "tw_counties_grid1"                        
##  [73] "tw_counties_grid2"                        
##  [74] "af_prov_grid1"                            
##  [75] "us_mi_counties_grid1"                     
##  [76] "pe_prov_grid1"                            
##  [77] "sa_prov_grid2"                            
##  [78] "mx_state_grid3"                           
##  [79] "cn_bj_districts_grid1"                    
##  [80] "us_va_counties_grid1"                     
##  [81] "us_mo_counties_grid1"                     
##  [82] "cl_santiago_prov_grid1"                   
##  [83] "us_tx_capcog_counties_grid1"              
##  [84] "sg_planning_area_grid1"                   
##  [85] "in_state_ut_grid1"                        
##  [86] "cn_fujian_prov_grid1"                     
##  [87] "ca_quebec_electoral_districts_grid1"      
##  [88] "nl_prov_grid2"                            
##  [89] "cn_bj_districts_grid2"                    
##  [90] "ar_santiago_del_estero_prov_grid1"        
##  [91] "ar_formosa_prov_grid1"                    
##  [92] "ar_chaco_prov_grid1"                      
##  [93] "ar_catamarca_prov_grid1"                  
##  [94] "ar_jujuy_prov_grid1"                      
##  [95] "ar_neuquen_prov_grid1"                    
##  [96] "ar_san_luis_prov_grid1"                   
##  [97] "ar_san_juan_prov_grid1"                   
##  [98] "ar_santa_fe_prov_grid1"                   
##  [99] "ar_la_rioja_prov_grid1"                   
## [100] "ar_mendoza_prov_grid1"                    
## [101] "ar_salta_prov_grid1"                      
## [102] "ar_rio_negro_prov_grid1"                  
## [103] "uy_departamentos_grid1"                   
## [104] "ar_buenos_aires_prov_electoral_dist_grid1"
## [105] "europe_countries_grid1"                   
## [106] "argentina_grid2"                          
## [107] "us_state_without_DC_grid2"                
## [108] "jp_prefs_grid2"                           
## [109] "na_regions_grid1"                         
## [110] "mm_state_grid1"                           
## [111] "us_state_with_DC_PR_grid1"                
## [112] "fr_departements_grid1"                    
## [113] "ar_salta_prov_grid2"                      
## [114] "ie_counties_grid1"                        
## [115] "sg_regions_grid1"                         
## [116] "us_ny_counties_grid1"                     
## [117] "ru_federal_subjects_grid1"                
## [118] "us_ca_counties_grid1"                     
## [119] "lk_districts_grid1"                       
## [120] "us_state_without_DC_grid3"                
## [121] "co_cali_subdivisions_grid1"               
## [122] "us_in_northern_counties_grid1"            
## [123] "italy_grid3"                              
## [124] "us_state_with_DC_PR_grid2"                
## [125] "us_state_grid7"                           
## [126] "sg_planning_area_grid2"                   
## [127] "ch_cantons_fl_grid1"                      
## [128] "europe_countries_grid2"                   
## [129] "us_states_territories_grid1"              
## [130] "us_tn_counties_grid1"                     
## [131] "us_il_chicago_community_areas_grid1"      
## [132] "us_state_with_DC_PR_grid3"                
## [133] "in_state_ut_grid2"                        
## [134] "at_states_grid1"                          
## [135] "us_pa_counties_grid1"                     
## [136] "us_oh_counties_grid1"                     
## [137] "fr_departements_grid2"                    
## [138] "us_wi_counties_grid1"                     
## [139] "africa_countries_grid1"                   
## [140] "no_counties_grid1"                        
## [141] "tr_provinces_grid1"</code></pre>
<p>For states or other regions that aren’t yet included in {geofacet}’s grids, you can construct one using the <a href="https://hafen.github.io/grid-designer/">Geo Grid Designer</a>. For more information, see <a href="https://cran.r-project.org/package=geofacet">the geofacet page on CRAN</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sean Davis, VJ Carey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
